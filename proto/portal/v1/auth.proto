syntax = "proto3";

package portal.v1;

option go_package = "github.com/jredh-dev/nexus/gen/portal/v1;portalv1";

// AuthService handles user authentication and session management.
service AuthService {
  // Login authenticates a user with email and password.
  rpc Login(LoginRequest) returns (LoginResponse);

  // Signup creates a new user account and logs them in.
  rpc Signup(SignupRequest) returns (SignupResponse);

  // Logout destroys the current session.
  rpc Logout(LogoutRequest) returns (LogoutResponse);

  // GetSession returns the current user's session info.
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse);

  // MagicLogin authenticates via a one-time magic link token.
  rpc MagicLogin(MagicLoginRequest) returns (MagicLoginResponse);

  // GenerateMagicLink creates a magic login link for a user (admin only).
  rpc GenerateMagicLink(GenerateMagicLinkRequest) returns (GenerateMagicLinkResponse);
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message LoginResponse {
  string session_id = 1;
  User user = 2;
}

message SignupRequest {
  string username = 1;
  string name = 2;
  string email = 3;
  string phone = 4;
  string password = 5;
}

message SignupResponse {
  string session_id = 1;
  User user = 2;
}

message LogoutRequest {}
message LogoutResponse {}

message GetSessionRequest {}

message GetSessionResponse {
  User user = 1;
  repeated Session sessions = 2;
}

message MagicLoginRequest {
  string token = 1;
}

message MagicLoginResponse {
  string session_id = 1;
  User user = 2;
}

message GenerateMagicLinkRequest {
  string email = 1;
}

message GenerateMagicLinkResponse {
  string magic_link = 1;
}

// User represents an authenticated user.
message User {
  string id = 1;
  string username = 2;
  string name = 3;
  string email = 4;
  string phone = 5;
  string role = 6;
  string created_at = 7;
  string last_login = 8;
}

// Session represents an active user session.
message Session {
  string id = 1;
  string ip_address = 2;
  string user_agent = 3;
  string created_at = 4;
  string expires_at = 5;
}
